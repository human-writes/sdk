(()=>{"use strict";const t="&lt;",e="&gt;";class s{#t=[];#e="";#s="";#n=[];#i=[];#r=[];#l=[];#o=[];#a=[];constructor(t,e=!1){this.#e=t.trim(),this.#s=`${this.#e}\n<Eof />`,this.protect(),e&&this.markupQuotes(),this.collectWords(this.#s),this.makeMistakes()}get list(){return this.#t}get text(){return this.#e}get workingText(){return this.#s}get words(){return this.#n}get mistakes(){return this.#o}get mistakeCursors(){return this.#a}get phraseStarts(){return this.#i}get phraseLengths(){return this.#r}get wordEnds(){return this.#l}#h(){return Date.now()*Math.random()}translateBracket(t,e,s=!1){let n=t,i=!1;return"CDETQRG".includes(e)&&("C"===e&&(n=s?")":"(",i=!0),"D"===e&&(n=s?"}}":"{{",i=!0),"E"===e&&(n=s?"}":"{",i=!0),"T"===e&&(n=s?"]":"[",i=!0),"Q"===e&&(n="'",i=!0),"R"===e&&(n='"',i=!0),"G"===e&&(n="`",i=!0)),{word:n,translated:i}}markupQuotes(){let t=this.#s;const e=/(["'`])((\s|((\\)*)\\.|.)*?)\1/gm;let s;const n=[];for(;null!==(s=e.exec(t));)s.index===e.lastIndex&&e.lastIndex++,n.push(s);for(let e=n.length-1;e>-1;e--){const s=n[e],i=s[1],r=s[0];let l=s[2];const o=s.index+1,a=o+r.length-1;let h="";'"'===i?h="R":"'"===i?h="Q":"`"===i&&(h="G"),l=l.replace(/&lt;/g,"&pp;"),l=l.replace(/&gt;/g,"&pg;");const c=`&oq;${h}&cq;${l}&oq;/${h}&cq;`,u=t.substring(0,o-1),d=t.substring(a);t=u+c+d}this.#s=t}doAttributes(t){const e={},s=/([\w]*)(\[\])?=("([\S ][^"]*)"|'([\S]*)'|\{\{ ([\w]*) \}\}|\{([\S ]*)\})/gm;let n;const i=[];for(;null!==(n=s.exec(t));)n.index===s.lastIndex&&s.lastIndex++,i.push(n);for(let t=0;t<i.length;t++){const s=i[t],n=s[1],r=s[2],l=s[3].substring(0,1),o=s[4];"[]"===r?(void 0===e[n]&&(e[n]=[]),e[n].push(l+o)):e[n]=`${l}${o}`}return e}isClosedTag(t){let s=!1;const{text:n}=t;return""===n||(s=n.substring(n.length-5,n.length)==="/"+e),s}isCloserTag(e){let s=!1;const{text:n}=e;return""===n||(s=n.substring(0,5)===t+"/"),s}makeTag(t,e,s,n,i=!1){const{text:r}=t,{name:l}=t,o=this.list.length,a={};return a.id=t.id,a.name=""===l?"Fragment":l,a.text=r,a.startsAt=t.startsAt,a.endsAt=t.endsAt,i||(a.uid=this.#h,a.method="echo",a.props=(a.name,[]),a.depth=s,a.hasCloser=n,a.node=!1,a.isSingle=!1),void 0!==e[s]&&null!==e[s]||(e[s]=o-1),a.parentId=e[s],a}protect(){let s=this.#s;s=s.trim(),s=s.replace(/\{\{/g,"<D>"),s=s.replace(/\}\}/g,"</D>"),s=s.replace(/\(/g,"<C>"),s=s.replace(/\)/g,"</C>"),s=s.replace(/\{/g,"<E>"),s=s.replace(/\}/g,"</E>"),s=s.replace(/\[/g,"<T>"),s=s.replace(/\]/g,"</T>"),s=s.replace(/<([/\w])/g,`${t}$1`),s=s.replace(/>/g,e),this.#s=s}collectTags(s,n="[\\w]+"){const i=[],r=[],l=new RegExp(`${t}\\/?(${n})((\\s|.*?)*?)\\/?${e}`,"gm");let o;for(;null!==(o=l.exec(s));)o.index===l.lastIndex&&l.lastIndex++,r.push(o);let a=0;return r.forEach((t=>{const e=t;e.id=a,e.text=t[0],e.name=null===t[1]?"Fragment":t[1],e.startsAt=t.index,e.endsAt=t.index+e.text.length-1,delete e[0],delete e[1],delete e[2],delete e[3],i.push(e),a++})),i}collectWords(t){const e=[],s=[];let n,i=/([&oqpg;]{4})[\w /]+([&cqpp;]{4})/gm;for(;null!==(n=i.exec(t));)n.index===i.lastIndex&&i.lastIndex++,s.push(n);let r=t;for(let t=s.length-1;t>-1;t--){const e=s[t][0],n=s[t].index+1,i=n+e.length-1,l="•".repeat(e.length),o=r.substring(0,n-1),a=r.substring(i);r=o+l+a}for(i=/([&lt;]{4})[\w /]+([&gt;]{4})/gm;null!==(n=i.exec(r));)n.index===i.lastIndex&&i.lastIndex++,s.push(n);for(let t=s.length-1;t>-1;t--){const e=s[t][0],n=s[t].index+1,i=n+e.length-1,l="•".repeat(e.length),o=r.substring(0,n-1),a=r.substring(i);r=o+l+a}for(i=/([&ltgt;]{4})/gm;null!==(n=i.exec(r));)n.index===i.lastIndex&&i.lastIndex++,s.push(n);for(let t=s.length-1;t>-1;t--){const e=s[t][0],n=s[t].index+1,i=n+e.length-1,l="•".repeat(e.length),o=r.substring(0,n-1),a=r.substring(i);r=o+l+a}for(i=/((?!•)\S[^•\n]*)/g;null!==(n=i.exec(r));)n.index===i.lastIndex&&i.lastIndex++,this.#i.push(n.index),this.#r.push(n[0].length);for(i=/((?!•)\S[^•\n ]*)/g;null!==(n=i.exec(r));){n.index===i.lastIndex&&i.lastIndex++;const t={};t.text=n[0],t.startsAt=n.index,t.endsAt=t.startsAt+n[0].length-1,e.push(t),this.#l.push(t.endsAt)}this.#n=e}makeMistakes(){let t=Math.ceil(2*Math.random())-2;const e=Math.ceil(3*Math.random())+2;this.#n.forEach((s=>{if(t++,t%e!=0||s.text.length<4)return;const n=Math.ceil(Math.random()*s.text.length)-1,i=String.fromCharCode(Math.ceil(26*Math.random())+96);this.#a.push(s.startsAt+n),this.#o.push(i)}))}makeFaultyText(){let t=this.#s;this.#o.forEach((e=>{const s=t.substring(0,e.startsAt),n=t.substring(e.endsAt+1);t=s+e.text+n})),this.#s=t}splitTags(t){let e=[...t],s=e.length,n=0,i=!1,r=0;const l=s;let o=!1;const a=[],h=[];for(;e.length>0&&!i&&!o;){if(n===s){if(n=0,e=Object.values(e),s=e.length,0===s){i=!0;continue}r++,o=r>l+1}const t=e[n];if(1!==e.length||"Eof"!==t.name)if(this.isClosedTag(t)&&"Eof"!==t.name)h[n]=e[n],delete e[n],n++;else{if(n+1<s){const s=e[n+1];if(!this.isCloserTag(t)&&this.isCloserTag(s)){if(t.name!==s.name){a.push(t),delete e[n],n++;continue}h[n]=e[n],h[n+1]=e[n+1],delete e[n],delete e[n+1],n+=2;continue}}n++}else i=!0}return{regularTags:h,singleTags:a}}replaceTags(t,s){let n=t,i=s;const r=[];s.forEach((t=>{r[t.id]=t})),r.sort(),i=Object.values(r);for(let t=i.length-1;t>-1;t--){const s=i[t];s.text=s.text.substring(0,s.text.length-4)+"/"+e;const r=n.substring(0,s.startsAt),l=n.substring(s.endsAt+1);n=r+s.text+l}return n}doComponents(t="[\\w]+"){let e=this.#s;const s=this.collectTags(e,t),n=[];let i=[],r=0;const l=[];let o=s.length,a=0,h=!1,c=0;const u=o;let d=!1;l[r]=-1;const{singleTags:g}=this.splitTags(s);let p=s;for(g.length&&(g.forEach((t=>n.push(t.id))),e=this.replaceTags(e,g),p=this.collectTags(e,t));p.length>0&&!h&&!d;){if(a===o){if(a=0,p=Object.values(p),o=p.length,0===o){h=!0;continue}c++,d=c>u+1}const t=p[a];if(1!==p.length||"Eof"!==t.name)if(this.isClosedTag(t)&&"Eof"!==t.name){const e=this.makeTag(t,l,r,!1);e.isSingle=n.includes(t.id),i[e.id]=e,delete p[a],a++}else{if(this.isCloserTag(t)&&r--,a+1<o){const s=p[a+1];if(!this.isCloserTag(t)&&this.isCloserTag(s)){const n=this.makeTag(t,l,r,!0),o=this.makeTag(s,l,r,!1,!0);o.contents={},o.parentId=n.id,o.contents.startsAt=n.endsAt+1,o.contents.endsAt=o.startsAt;const h=e.substring(o.contents.startsAt,o.contents.endsAt);o.contents.text=h,n.closer=o,i[n.id]=n,delete p[a],delete p[a+1],a+=2;continue}this.isCloserTag(t)||this.isCloserTag(s)||(r++,l[r]=t.id)}a++}else h=!0}i=Object.values(i),this.#s=e,this.#t=i}}const n="&lt;",i="&gt;",r="<",l=">",o="/",a="\n";class h{#c=null;constructor(t){this.#c=t}async writeLikeAHuman(t,e){const h=void 0!==e,c=this.#c.shadowRoot.querySelector(`pre#${e} code`),u=this.#c.shadowRoot.querySelector(h?`pre#${t} code`:`div#${t}`);let d=this.#c.speed,g=[],p="",f="",m="",w=null,x=[];const b=[];let k="",A="",T=-1;const C=[],E=[];let y=0,v=this;function S(t){return new Promise((e=>{setTimeout(e,t)}))}async function I(t,e=!1){let s=g.join("");e&&(s=s.trim()),d=function(t){return Math.floor(.75*t+Math.random()*t)}(v.#c.speed),p+=t,u.innerHTML=p+s,h&&void 0!==window.hljs&&window.hljs.highlightElement(u),await S(d)}async function L(){const t=g.join("");p=p.substring(0,p.length-1),u.innerHTML=p+t,await S(d)}function M(t){g.unshift(t)}function $(){delete g[0],g=Object.values(g)}function j(){let t=null;return x.length?(t=x.shift(),t.hasCloser&&b.push(t),t):t}function H(){if(!C.length)return null;const t=C.pop();M(E.pop()?a+f+t:t)}function R(t){let e=null;if(!b.length)return e;if(e=b.length?b[b.length-1]:null,t===e.depth)return e;let s=!1;for(let n=b.length-1;n>-1;n--)if(e=b[n],t===e.depth){s=!0;break}return s?e:null}const O=this.#c.getAttribute("source")??"";h&&void 0!==window.hljs&&window.hljs.highlightElement(c),k=await async function(t){let e="";return await fetch(t).then((t=>t.text())).then((t=>{e=t})),e}(O);const q=function(t){const e=[],s=/^([^\S][ \s]+)*/gm;let n;for(;null!==(n=s.exec(t));)n.index===s.lastIndex&&s.lastIndex++,e.push(n[0]??"");return e}(k);k=k.replace(/^([^\S][ \s]+)*/gm,"");const W=new s(k,h);W.doComponents(),x=[...W.list],A=W.workingText.replace(`${a+n}Eof ${o}${i}`,""),h&&(c.innerHTML=function(t){const e=t.split("\n");return"<br />".repeat(e.length)}(k+"\n"));const D=q[y]??"";await I(D),y++;for(let t=0;t<A.length;t++){let e=A[t];if(h&&e===r){e=n,await I(e);continue}if(this.#c.makeMistakes&&W.mistakes.length&&W.phraseStarts.length&&W.phraseStarts[0]===t){const s=W.phraseLengths[0];for(let n=0;n<s;n++){const s=t+n,i=W.mistakeCursors[0];if(e=A[s],i===s?await I(W.mistakes[0]):await I(e),W.wordEnds.includes(s)&&W.mistakeCursors.length){const t=W.mistakeCursors[0];if(t<=s){const e=s-t+1;for(let t=0;t<e;t++)await L(),n--;W.mistakes.shift(),W.mistakeCursors.shift()}}}W.phraseStarts.shift(),W.phraseLengths.shift(),t+=s-1;continue}const s=A.substring(t,t+4),c=A.substring(t,t+5);if("&"!==e||"&oq;/"!==c)if("&"!==e||"&oq;"!==s)if("&"!==e||"&pp;"!==s)if("&"!==e||"&pg;"!==s){if(h){if("/"===e&&c===o+i&&null!==w&&!w.hasCloser&&w.endsAt===t+4){e=o+i,$(),await I(e),t+=4;continue}if("&"===e&&s===i&&null!==w&&w.endsAt===t+3){$(),await I(i),w.hasCloser&&H(),t+=3;continue}}if("&"===e&&c===n+o){w=R(T),null===w&&T-1>-1&&(w=R(T-1)),e=w.closer.text,h||(e=r+o+w.closer.name+l);const{word:s}=W.translateBracket(e,w.name,!0);if(e=s,""!==e){$(),t=w.closer.endsAt,await I(e),T--,w=null;continue}}if("&"!==e||s===n)if("&"!==e||s!==n)if(e!==a)await I(e);else{f=q[y]??"",m=a+f;const e=g.length?g[0].trim():"",s=A.substring(t+1,t+e.length+1);y++,await I(m,e===s)}else{if((null===w||null!==w&&w.dirty)&&(w=j()),w.startsAt!==t){h?(e=n,t+=3):(e=w.text.replace(n,r),e=e.replace(i,l)),await I(e),w.dirty=!1;continue}w.dirty=!0;let s=!1,c="";e=w.text,h||(e=w.text.replace(n,r),e=e.replace(i,l));const{word:u,translated:d}=W.translateBracket(e,w.name);if(e=u,w.hasCloser){T++,c=w.closer.text,h||(c=r+o+w.closer.name+l);const{word:e,translated:n}=W.translateBracket(c,w.name,!0);c=e,s=w.closer.contents.text.indexOf(a)>-1,n?(t=w.endsAt,M(s?a+f+c:c)):(C.push(c),E.push(s))}d||(s=w.text.indexOf(a)>-1,h?(e=n,t+=3,c=i):(e=w.text.replace(n,r),e=e.replace(i,l),t+=w.text.length-1,c=r+o+w.closer.name+l),M(s?a+f+c:c)),await I(e)}else{const s=A.substring(t).indexOf(";");if(s>8){await I(e);continue}const n=A.substring(t,t+s+1);await I(n),t+=n.length-1}}else t+=3,await I(i);else t+=3,await I(n);else{const s=A.substring(t+4,t+5),{word:n}=W.translateBracket(e,s);M(n),await I(n),t+=8}else{const s=A.substring(t+5,t+6),{word:n}=W.translateBracket(e,s);$(),await I(n),t+=9}}p=p.replaceAll(n,r).replaceAll(i,l);const B=new CustomEvent("finishedWriting",{bubbles:!0,composed:!0,detail:{content:p}});this.#c.dispatchEvent(B),this.#c.setAttribute("finished","true")}}class c extends HTMLElement{constructor(){super()}static get observeAttributes(){return["source","speed","depends-on-selector","make-mistakes","styles","classes","finished"]}get source(){return this.getAttribute("source")??null}get speed(){return this.getAttribute("speed")??60}get dependsOnSelector(){return this.getAttribute("depends-on-selector")??null}get makeMistakes(){return"true"===(this.getAttribute("make-mistakes")??"").toLowerCase()}get styles(){return this.getAttribute("styles")??null}get classes(){return this.getAttribute("classes")??null}get finished(){return this.getAttribute("finished")??null}get restart(){return this.getAttribute("restart")??null}async connectedCallback(){if(null!==this.styles&&null!==this.classes&&(this.styles.split(",").forEach((t=>{const e=document.createElement("style");e.innerHTML=`@import "${t}"`,this.shadowRoot.appendChild(e)})),this.shadowRoot.getElementById("to-write").setAttribute("class",this.classes)),null!==this.dependsOnSelector){const t=document.querySelector(this.dependsOnSelector);if(void 0!==t&&("TEXT-WRITER"===t.tagName||"CODE-WRITER"===t.tagName)){const e={attributes:!0};new MutationObserver(((e,s)=>{for(const n of e)"attributes"===n.type&&"finished"===n.attributeName&&t.finished&&(s.disconnect(),this.writeLikeAHuman())})).observe(t,e)}}else this.writeLikeAHuman()}writeLikeAHuman(){}}customElements.define("code-writer",class extends c{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`\n<style>\n\n#to-copy {\n    display: block;\n    position: relative;\n    float: left;\n    width: ${this.snippetWidth};\n}\n\n#to-write {\n    width: ${this.snippetWidth};\n}\n\n.to-be-copied {\n    display: block;\n    position: relative;\n    float: left;\n}\n\n.to-be-written {\n    display: flex;\n    position: absolute;\n    width: ${this.snippetWidth};\n}\n\n.code-snippet {\n    display: flex;\n    font-size: medium;\n}\n\ndiv,\np,\nspan,\ntextarea {\n    -tab-size: 4;\n    -o-tab-size: 4;\n    -moz-tab-size: 4;\n}\n\n</style>\n\n<div class="code-snippet">\n    <div class="to-be-copied">\n        <pre id="to-copy"><code></code></pre>\n    </div>\n    <div class="to-be-written">\n        <pre id="to-write"><code></code></pre>\n    </div>\n</div>\n`}static get observeAttributes(){const t=super.observeAttributes();return Array.prototype.concat(t,["use-highlight-js","theme","language","snippet-width"])}get useHighlightJs(){return"true"===(this.getAttribute("use-highlight-js")??"").toLowerCase()}get theme(){return this.getAttribute("theme")??null}get language(){return this.getAttribute("language")??null}get snippetWidth(){return this.getAttribute("snippet-width")??"45vw"}async connectedCallback(){if(this.useHighlightJs){const t=this.theme??"base16/monokai",e=this.language??"html",s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",this.shadowRoot.appendChild(s);const n=[];n.push("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"),n.push(`https://highlightjs.org/static/demo/styles/${t}.css`),n.forEach((t=>{const e=document.createElement("style");e.innerHTML=`@import "${t}"`,this.shadowRoot.appendChild(e)}));const i=this.shadowRoot.querySelectorAll("code");for(const t of i)t.setAttribute("class",`language-${e}`)}super.connectedCallback()}writeLikeAHuman(){new h(this).writeLikeAHuman("to-write","to-copy")}}),customElements.define("text-writer",class extends c{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n<div class="text-snippet">\n    <div class="to-be-written">\n        <div id="to-write"></div>\n    </div>\n</div>\n'}writeLikeAHuman(){new h(this).writeLikeAHuman("to-write")}})})();